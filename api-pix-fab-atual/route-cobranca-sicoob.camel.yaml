- route:
    id: route-cobranca-sicoob
    nodePrefixId: route-ecf
    from:
      id: from-route-cobranca-sicoob
      uri: direct
      parameters:
        name: route-cobranca-sicoob
      steps:
        - log:
            id: log-34fd
            description: "# ROUTE SICOOB COBRANCA #"
            message: "# ROUTE SICOOB COBRANCA #"
        - doTry:
            id: doTry-6f61
            doCatch:
              - id: doCatch-8edb
                exception:
                  - java.lang.Exception
                steps:
                  - setProperty:
                      id: setProperty-4c60
                      description: "Var: errorRoute"
                      name: errorRoute
                      expression:
                        simple:
                          id: simple-d45f
                          expression: >-
                            "informativo": "Erro no envio de payload", "route":
                            "route-cobranca-sicoob", "retorno":
                            ${exception.getResponseBody()}
                  - to:
                      id: to-0d69
                      uri: direct
                      parameters:
                        name: route-trata-erros
            steps:
              - log:
                  id: log-00ea
                  description: "# URL SICOOB #"
                  message: "# URL SICOOB ${exchangeProperty.bancoURL}"
              - removeHeaders:
                  id: removeHeaders-b322
                  pattern: "*"
              - log:
                  id: log-9746
                  description: "# OBRIGATORIO A REMOCAO DE HEADERS #"
                  message: "# OBRIGATORIO A REMOCAO DE HEADERS #"
              - setHeaders:
                  id: setHeaders-7430
                  headers:
                    - id: setHeader-3a63
                      name: Authorization
                      expression:
                        simple:
                          id: simple-a07b
                          expression: Bearer 1301865f-c6bc-38f3-9f49-666dbcfc59c3
                    - id: setHeader-11f1
                      name: client_id
                      expression:
                        simple:
                          id: simple-df40
                          expression: ${exchangeProperty.bancoPayloadDados[clientId]}
                    - id: setHeader-34da
                      name: Content-Type
                      expression:
                        simple:
                          id: simple-2263
                          expression: application/json
              - log:
                  id: log-f2f8
                  description: "# NÃO PODE USAR LOG ACTIVE#"
                  message: ${body}
              - choice:
                  id: choice-2afe
                  when:
                    - id: when-4e44
                      description: Registrar
                      expression:
                        simple:
                          id: simple-84e5
                          expression: ${exchangeProperty.rota[tipo]} == 'registrar'
                      steps:
                        - log:
                            id: log-7564
                            description: "# SICOOB ENVIA REGISTRO #"
                            message: "# SICOOB ENVIA REGISTRO #"
                        - setProperty:
                            id: setProperty-6375
                            description: urlRegistroBoleto
                            name: urlRegistroBoleto
                            expression:
                              simple:
                                id: simple-e6e1
                                expression: ${exchangeProperty.bancoURL}
                        - toD:
                            id: to-f030
                            uri: https
                            parameters:
                              httpUri: ${exchangeProperty.urlRegistroBoleto}
                              bridgeEndpoint: true
                              httpMethod: POST
                              logHttpActivity: false
                        - stop:
                            id: stop-e85f
                    - id: when-e594
                      description: Alterar
                      expression:
                        simple:
                          id: simple-b46a
                          expression: ${exchangeProperty.rota[tipo]} == 'alterar'
                      steps:
                        - setProperty:
                            id: setProperty-6b66
                            description: urlRegistroBoleto
                            name: urlRegistroBoleto
                            expression:
                              simple:
                                id: simple-5220
                                expression: >-
                                  ${exchangeProperty.bancoURL}/${exchangeProperty.boletoNossoNumero}
                        - log:
                            id: log-b617
                            description: "# SICOOB ENVIA ALTERACAO #"
                            message: >-
                              # SICOOB ENVIA ALTERACAO #
                              ${exchangeProperty.urlRegistroBoleto}
                            logName: "# SICOOB ENVIA ALTERACAO #"
                        - toD:
                            id: to-b52b
                            disabled: false
                            uri: https
                            parameters:
                              bridgeEndpoint: true
                              httpMethod: PATCH
                              httpUri: ${exchangeProperty.urlRegistroBoleto}
                    - id: when-49ab
                      description: Cancelar
                      expression:
                        simple:
                          id: simple-3b3c
                          expression: ${exchangeProperty.rota[tipo]} == 'cancelar'
                      steps:
                        - setProperty:
                            id: setProperty-0d4d
                            description: urlRegistroBoleto
                            name: urlRegistroBoleto
                            expression:
                              simple:
                                id: simple-7bc3
                                expression: >-
                                  ${exchangeProperty.bancoURL}/${exchangeProperty.boletoNossoNumero}/baixar
                        - log:
                            id: log-f03a
                            description: "# SICOOB ENVIA CANCELAR #"
                            message: >-
                              # SICOOB ENVIA CANCELAR #
                              ${exchangeProperty.urlRegistroBoleto}
                        - toD:
                            id: to-6514
                            uri: https
                            parameters:
                              httpUri: ${exchangeProperty.urlRegistroBoleto}
                              httpMethod: POST
                              bridgeEndpoint: true
                  otherwise:
                    id: otherwise-1066
              - choice:
                  id: choice-6cf5
                  disabled: false
                  when:
                    - id: when-54a4
                      description: Teste Status (204)
                      expression:
                        simple:
                          id: simple-9c8c
                          expression: ${header.CamelHttpResponseCode} == 204
                      steps:
                        - removeHeaders:
                            id: removeHeaders-8cfa
                            pattern: "*"
                        - setHeader:
                            id: setHeader-5b41
                            disabled: false
                            name: CamelHttpResponseCode
                            expression:
                              simple:
                                id: simple-25f6
                                expression: "200"
                        - setBody:
                            id: setBody-b2ba
                            expression:
                              simple:
                                id: simple-9c8f
                                expression: >-
                                  { "status": 602, "mensagem": "Alteração
                                  realizada com sucesso" }
                        - log:
                            id: log-c885
                            description: "# FIM SICOOB #"
                            message: "# FIM SICOOB # ${body}"
                  otherwise:
                    id: otherwise-d014
                    steps:
                      - log:
                          id: log-6795
                          message: ${body}
