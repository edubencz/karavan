- route:
    id: route-trata-erros
    from:
      id: from-b5b2
      uri: direct
      parameters:
        name: route-trata-erros
      steps:
        - log:
            id: log-30dc
            description: errorRoute
            message: ${exchangeProperty.errorRoute}
        - choice:
            id: choice-e5df
            when:
              - id: when-nullpointer
                description: NullException
                expression:
                  simple:
                    id: simple-npe
                    expression: ${exception.class} == 'java.lang.NullPointerException'
                steps:
                  - setBody:
                      id: setBody-npe
                      expression:
                        simple:
                          id: simple-npe-body
                          expression: >-
                            { "status": 500, "error": "Erro interno de aplicação
                            (NullPointerException)",
                              ${exchangeProperty.errorRoute}, "exception": "${exception.message}" }
                  - setHeader:
                      id: setHeader-npe
                      disabled: true
                      name: CamelHttpResponseCode
                      expression:
                        simple:
                          id: simple-npe-header
                          expression: "500"
                  - log:
                      id: log-npe
                      message: "Erro NullPointerException tratado: ${exception.message}"
              - id: when-resolve-endpoint
                description: ResolveEndpointFailedException
                expression:
                  simple:
                    id: simple-15ab
                    expression: >-
                      ${exception.class} ==
                      'org.apache.camel.ResolveEndpointFailedException'
                steps:
                  - setBody:
                      id: setBody-ed4a
                      expression:
                        simple:
                          id: simple-da57
                          expression: >-
                            { "status": 500, "error": "Falha ao resolver
                            endpoint ou certificado inválido",
                            ${exchangeProperty.errorRoute}, "exception":
                            "${exception.message}" }
                  - setHeader:
                      id: setHeader-9514
                      disabled: true
                      name: CamelHttpResponseCode
                      expression:
                        simple:
                          id: simple-7f0b
                          expression: "500"
                  - log:
                      id: log-813e
                      message: "Erro SSL/endpoint tratado: ${exception.message}"
              - id: when-0aee
                description: statusCode (400)
                expression:
                  simple:
                    id: simple-378c
                    expression: ${exception.statusCode} == 400
                steps:
                  - log:
                      id: log-0711
                      description: "# ERRO 400 #"
                      message: "# ERRO 400 #"
                  - setBody:
                      id: setBody-48fa
                      expression:
                        simple:
                          id: simple-8b32
                          expression: >-
                            { "status": 400, "error": "Informação não
                            identificada", "ret_bancario" :
                              ${exception.getResponseBody()} }
                  - setHeader:
                      id: setHeader-c91d
                      disabled: true
                      name: CamelHttpResponseCode
                      expression:
                        simple:
                          id: simple-30e0
                          expression: ${exception.statusCode}
                  - log:
                      id: log-24b9
                      message: "Erro 400 tratado (API externa): ${body}"
              - id: when-400-interno
                description: CamelHttpResponseCode (400)
                expression:
                  simple:
                    id: simple-8941
                    expression: ${header.CamelHttpResponseCode} == 400
                steps:
                  - log:
                      id: log-ec8f
                      description: "# ERRO 400 CAMEL #"
                      message: "# ERRO 400 CAMEL: ${exchangeProperty.errorRoute}"
                  - stop:
                      id: stop-e94c
                      disabled: true
                  - choice:
                      id: choice-7fc2
                      when:
                        - id: when-d88c
                          expression:
                            simple:
                              id: simple-9d53
                              expression: ${exception.getResponseBody()} != null
                          steps:
                            - log:
                                id: log-353a
                                description: "# ERRO AQUI #"
                                message: "# ERRO AQUI #"
                            - setBody:
                                id: setBody-f12a
                                expression:
                                  simple:
                                    id: simple-f6f7
                                    expression: >-
                                      { "status": 400, "error": "Informação não
                                      identificada", "ret_bancario" :
                                        ${exception.getResponseBody()} }
                      otherwise:
                        id: otherwise-be59
                        steps:
                          - log:
                              id: log-7b79
                              description: "# ERRO AQUI F #"
                              message: "# ERRO AQUI F#"
                          - setBody:
                              id: setBody-8711
                              expression:
                                simple:
                                  id: simple-3a74
                                  expression: >-
                                    { "status": 400, "error": "Informação não
                                    identificada",
                                    ${exchangeProperty.errorRoute} }
                  - log:
                      id: log-e1d0
                      message: "Erro 400 tratado (choice interno): ${body}"
              - id: when-f2ea
                description: statusCode (403)
                expression:
                  simple:
                    id: simple-ee9e
                    expression: ${exception.statusCode} == 403
                steps:
                  - setBody:
                      id: setBody-2854
                      expression:
                        simple:
                          id: simple-174d
                          expression: >-
                            { "status": 403, "error": "Token inválido ou mal
                            formatado", ${exchangeProperty.errorRoute},
                            "exception": "${exception.getResponseBody()}" }
                  - setHeader:
                      id: setHeader-cf28
                      disabled: true
                      name: CamelHttpResponseCode
                      expression:
                        simple:
                          id: simple-fd86
                          expression: ${exception.statusCode}
                  - log:
                      id: log-c91e
                      message: "Erro 403 tratado: ${body}"
              - id: when-cc34
                description: statusCode (404)
                expression:
                  simple:
                    id: simple-81f2
                    expression: ${exception.statusCode} == 404
                steps:
                  - setBody:
                      id: setBody-9ad0
                      expression:
                        simple:
                          id: simple-4039
                          expression: |-
                            { "status": 404, "error": "NOT_FOUND",
                              ${exchangeProperty.errorRoute}, "exception":
                              ${exception.getResponseBody()} }
                  - setHeader:
                      id: setHeader-d76a
                      disabled: true
                      name: CamelHttpResponseCode
                      expression:
                        simple:
                          id: simple-106f
                          expression: ${exception.statusCode}
                  - log:
                      id: log-ed5d
                      message: "Erro 404 tratado: ${body}"
              - id: when-c3ab
                description: statusCode (204)
                expression:
                  simple:
                    id: simple-6ee8
                    expression: ${exception.statusCode} == 204
                steps:
                  - setBody:
                      id: setBody-d453
                      expression:
                        simple:
                          id: simple-2766
                          expression: |-
                            { "status": 204, "error": "NOT_FOUND",
                              ${exchangeProperty.errorRoute}, "exception":
                              ${exception.getResponseBody()} }
                  - setHeader:
                      id: setHeader-1f30
                      disabled: true
                      name: CamelHttpResponseCode
                      expression:
                        simple:
                          id: simple-6086
                          expression: ${exception.statusCode}
                  - log:
                      id: log-f15e
                      message: "Erro 204 tratado: ${body}"
              - id: when-503-exception
                description: statusCode (503)
                expression:
                  simple:
                    id: simple-503-exception
                    expression: ${exception.statusCode} == 503
                steps:
                  - log:
                      id: log-5429
                      description: Erro 503 StatusCode
                      message: "# Erro 503 StatusCode ${body}"
                  - setBody:
                      id: setBody-503-exception
                      expression:
                        simple:
                          id: simple-503-exception-body
                          expression: >-
                            { "status": 503, "error": "Serviço bancário
                            indisponível",
                              ${exchangeProperty.errorRoute}, "exception":
                              "${exception.message}" }
                  - setHeader:
                      id: setHeader-503-exception
                      disabled: true
                      name: CamelHttpResponseCode
                      expression:
                        simple:
                          id: simple-503-exception-header
                          expression: "503"
                  - log:
                      id: log-503-exception
                      message: "Erro 503 tratado (exception): ${exception.message}"
              - id: when-503-header
                description: CamelHttpResponseCode (503)
                expression:
                  simple:
                    id: simple-503-header
                    expression: ${header.CamelHttpResponseCode} == 503
                steps:
                  - log:
                      id: log-c579
                      description: Erro 503
                      message: "# Erro 503 ${body}"
                  - setBody:
                      id: setBody-503-header
                      expression:
                        simple:
                          id: simple-503-header-body
                          expression: >-
                            { "status": 503, "error": "Serviço bancário
                            indisponível",
                              ${exchangeProperty.errorRoute}, "exception":
                              "${exception.message}" }
                  - setHeader:
                      id: setHeader-503-header
                      disabled: true
                      name: CamelHttpResponseCode
                      expression:
                        simple:
                          id: simple-503-header-header
                          expression: "503"
                  - log:
                      id: log-503-header
                      message: "Erro 503 tratado (header): ${exception.message}"
              - id: when-503-exception-alt
                description: statusCode (401)
                disabled: false
                expression:
                  simple:
                    id: simple-503-exception-alt
                    expression: ${exception.statusCode} == 401
                steps:
                  - log:
                      id: log-9feb
                      description: Erro 401 StatusCode
                      message: "# Erro 401 StatusCode ${body}"
                  - setBody:
                      id: setBody-503-exception-alt
                      expression:
                        simple:
                          id: simple-503-exception-alt-body
                          expression: >-
                            { "status": 401, "error": "Erro alternativo: Serviço
                            bancário indisponível ou conexão com o banco
                            inválida, reveja dados banco no Workspace",
                              ${exchangeProperty.errorRoute}, "exception":
                              "${exception.message}" }
                  - setHeader:
                      id: setHeader-503-exception-alt
                      disabled: true
                      name: CamelHttpResponseCode
                      expression:
                        simple:
                          id: simple-503-exception-alt-header
                          expression: "503"
                  - log:
                      id: log-503-exception-alt
                      message: >-
                        Erro 503 alternativo tratado (exception):
                        ${exception.message}
              - id: when-503-header-alt
                description: Camel = 422
                disabled: false
                expression:
                  simple:
                    id: simple-503-header-alt
                    expression: ${header.CamelHttpResponseCode} == 422
                steps:
                  - log:
                      id: log-5c3a
                      description: Erro Camel 422
                      message: "#Erro Camel 422 ${body}"
                  - setBody:
                      id: setBody-503-header-alt
                      expression:
                        simple:
                          id: simple-503-header-alt-body
                          expression: >-
                            { "status": 422, "error": "Erro alternativo: Serviço
                            bancário indisponível",
                              ${exchangeProperty.errorRoute}, exception:
                              "${exception.message}" }
                  - setHeader:
                      id: setHeader-503-header-alt
                      name: CamelHttpResponseCode
                      expression:
                        simple:
                          id: simple-503-header-alt-header
                          expression: "503"
                  - log:
                      id: log-503-header-alt
                      message: >-
                        Erro 503 alternativo tratado (header):
                        ${exception.message}
              - id: when-422
                description: statusCode (422)
                expression:
                  simple:
                    id: simple-422
                    expression: ${exception.statusCode} == 422
                steps:
                  - log:
                      id: log-adf8
                      description: Erro 422 StatusCode
                      message: "# Erro 422 StatusCode  ${body}"
                  - setBody:
                      id: setBody-422
                      expression:
                        simple:
                          id: simple-422-body
                          expression: |
                            { "status": 422, "error": "NOT_FOUND",
                              ${exchangeProperty.errorRoute}, exception:
                              ${exception.getResponseBody()} }
                  - setHeader:
                      id: setHeader-422
                      disabled: true
                      name: CamelHttpResponseCode
                      expression:
                        simple:
                          id: simple-422-header
                          expression: "400"
                  - log:
                      id: log-422
                      message: "Erro 422 tratado: ${body}"
            otherwise:
              id: otherwise-6391
              description: Nao identificado
              steps:
                - log:
                    id: log-189f
                    description: Erro Nao identificado
                    message: "# Erro Nao identificado  ${body}"
                - setBody:
                    id: setBody-0283
                    expression:
                      constant:
                        id: constant-4331
                        expression: >-
                          { status: 500, "error": "Falha interna ou não mapeada"
                          }
                - setHeader:
                    id: setHeader-cb7d
                    disabled: true
                    name: CamelHttpResponseCode
                    expression:
                      simple:
                        id: simple-aedb
                        expression: "500"
                - log:
                    id: log-6e31
                    message: "Erro não mapeado: ${exception.message}"
        - log:
            id: log-5d62
            description: "# STATUS 200 NAGENT COLOCA LIXO #"
            message: "# STATUS 200 NAGENT COLOCA LIXO #"
        - setHeader:
            id: setHeader-1a01
            disabled: false
            name: CamelHttpResponseCode
            expression:
              simple:
                id: simple-abc6
                expression: "200"
        - stop:
            id: stop-09e3
