- rest:
    id: rest-9f43
    consumes: application/json
    produces: application/json
    post:
      - id: post-0988
        path: /atualiza_status
        to: direct:inicio
- route:
    id: valida-payload
    from:
      id: from-9a4a
      uri: direct
      parameters:
        name: inicio
      steps:
        - unmarshal:
            id: unmarshal-json
            json:
              id: json-jackson
              library: Jackson
        - choice:
            id: choice-validacao
            when:
              - id: when-5b8a
                expression:
                  simple:
                    id: simple-8532
                    expression: ${body[linkAutoriz]} == null || ${body[linkAutoriz]} == ''
                steps:
                  - setHeader:
                      id: set-400-header-1
                      name: CamelHttpResponseCode
                      expression:
                        constant:
                          id: constant-c400-1
                          expression: "400"
                  - setBody:
                      id: set-body-erro-1
                      expression:
                        simple:
                          id: erro-1
                          expression: Campo linkAutoriz é obrigatório.
                  - stop:
                      id: stop-c44c
              - id: when-f461
                expression:
                  simple:
                    id: simple-8f0b
                    expression: ${body[linkRetorno]} == null || ${body[linkRetorno]} == ''
                steps:
                  - setHeader:
                      id: set-400-header-2
                      name: CamelHttpResponseCode
                      expression:
                        constant:
                          id: constant-c400-2
                          expression: "400"
                  - setBody:
                      id: set-body-erro-2
                      expression:
                        simple:
                          id: erro-2
                          expression: Campo linkRetorno é obrigatório.
                  - stop:
                      id: stop-c7a5
              - id: when-aea6
                expression:
                  simple:
                    id: simple-ab24
                    expression: ${body[chaveCript]} == null || ${body[chaveCript]} == ''
                steps:
                  - setHeader:
                      id: set-400-header-3
                      name: CamelHttpResponseCode
                      expression:
                        constant:
                          id: constant-c400-3
                          expression: "400"
                  - setBody:
                      id: set-body-erro-3
                      expression:
                        simple:
                          id: erro-3
                          expression: Campo chaveCript é obrigatório.
                  - stop:
                      id: stop-fa19
              - id: when-aea7
                expression:
                  simple:
                    id: simple-ab25
                    expression: ${body[userPass]} == null || ${body[userPass]} == ''
                steps:
                  - setHeader:
                      id: set-400-header-5
                      name: CamelHttpResponseCode
                      expression:
                        constant:
                          id: constant-c400-5
                          expression: "400"
                  - setBody:
                      id: set-body-erro-5
                      expression:
                        simple:
                          id: erro-5
                          expression: Campo userPass é obrigatório.
                  - stop:
                      id: stop-fa18
            otherwise:
              id: otherwise-validado
              steps:
                - to:
                    id: to-cripto
                    uri: direct
                    parameters:
                      name: cripto
- route:
    id: cripto-route
    from:
      id: from-4e57
      uri: direct
      parameters:
        name: cripto
      steps:
        - setHeader:
            id: setHeader-emailSenha
            name: emailSenha
            expression:
              simple:
                id: simple-userPass
                expression: ${body[userPass]}
        - setHeader:
            id: setHeader-chaveCript
            name: chaveCript
            expression:
              simple:
                id: simple-chaveCript
                expression: ${body[chaveCript]}
        - process:
            id: process-faa7
            description: Cripto
            ref: processor
        - log:
            id: log-1413
            message: ${body}
        - to:
            id: to-f708
            uri: direct
            parameters:
              name: autenticar-prime
- route:
    id: rota-autenticacao-prime
    from:
      id: from-autenticacao
      uri: direct
      parameters:
        name: autenticar-prime
      steps:
        - setProperty:
            id: setProperty-9249
            name: linkAutoriz
            expression:
              simple:
                id: simple-fe46
                expression: ${body[linkAutoriz]}
        - removeHeaders:
            id: removeHeaders-d75d
            pattern: "*"
        - setHeader:
            id: set-form-content-type
            name: Content-type
            expression:
              simple:
                id: simple-bfd6
                expression: multipart/form-data; boundary=X-INSOMNIA-BOUNDARY
        - setBody:
            id: set-body-form
            expression:
              simple:
                id: simple-9360
                expression: "--X-INSOMNIA-BOUNDARY\r\nContent-Disposition: form-data; name=\"token_solicitante\"\r\n\r\n${exchangeProperty.tokenSolicitante}\r\n--X-INSOMNIA-BOUNDARY--"
        - log:
            id: log-e675
            message: ${headers}
            logName: HEADERS$$$$$$
        - log:
            id: log-be56
            message: ${body}
            logName: Antes do REQUEST
        - toD:
            id: to-autorizacao
            uri: https
            parameters:
              bridgeEndpoint: true
              throwExceptionOnFailure: false
              httpMethod: POST
              httpUri: ${exchangeProperty.linkAutoriz}
              logHttpActivity: true
        - unmarshal:
            id: unmarshal-529a
            gzipDeflater:
              id: gzipDeflater-7d8a
        - log:
            id: log-0034
            message: ${body}
        - choice:
            id: verifica-status
            when:
              - id: when-65e0
                expression:
                  simple:
                    id: simple-3d74
                    expression: ${header.CamelHttpResponseCode} != 200
                steps:
                  - setHeader:
                      id: setHeader-b81c
                      name: CamelHttpResponseCode
                      expression:
                        constant:
                          id: constant-3fe3
                          expression: "400"
                  - setBody:
                      id: setBody-122a
                      expression:
                        constant:
                          id: constant-7166
                          expression: Erro na autenticação - status inválido
            otherwise:
              id: otherwise-380c
              steps:
                - convertBodyTo:
                    id: convert-body-xml
                    type: java.lang.String
                - setProperty:
                    id: set-token-prop
                    name: tokenSolicitante
                    expression:
                      xpath:
                        id: xpath-token
                        expression: //TokenValido/text()
                - setHeader:
                    id: set-header-token
                    name: Authorization
                    expression:
                      simple:
                        id: simple-token
                        expression: ${exchangeProperty.tokenSolicitante}
                - log:
                    id: log-token
                    message: Token obtido- ${header.Authorization}
